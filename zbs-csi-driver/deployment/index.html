<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>ZBS CSI Driver Deployment · IOMesh</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This topic explains how to install ZBS CSI Driver with kubernetes. Follow the steps in this topic in order."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="ZBS CSI Driver Deployment · IOMesh"/><meta property="og:type" content="website"/><meta property="og:url" content="http://iomesh.com/docs/"/><meta property="og:description" content="This topic explains how to install ZBS CSI Driver with kubernetes. Follow the steps in this topic in order."/><meta property="og:image" content="http://iomesh.com/docs/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="http://iomesh.com/docs/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/docs/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/docs/css/main.css"/><script src="/docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docs/"><img class="logo" src="/docs/img/favicon.ico" alt="IOMesh"/><h2 class="headerTitleWithLogo">IOMesh</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/zbs-csi-driver/overview" target="_self">Docs</a></li><li class=""><a href="https://github.com/iomesh" target="_blank">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>ZBS CSI Driver</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">ZBS CSI Driver</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zbs-csi-driver/overview">Overview</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zbs-csi-driver/deployment">Deployment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">ZBS Operator</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zbs-operator/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zbs-operator/deployment">Deployment</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">ZBS CSI Driver Deployment</h1></header><article><div><span><p>This topic explains how to install ZBS CSI Driver with kubernetes. Follow the steps in this topic in order.</p>
<h2><a class="anchor" aria-hidden="true" id="supported-platforms"></a><a href="#supported-platforms" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Supported platforms</h2>
<ul>
<li>Kubernetes node Linux distro: CentOS 7 and CentOS 8</li>
<li>Kubernetes v1.17 or higher</li>
<li>Openshift v4.5 or higher</li>
<li>ZBS v4.0.7-rc16 (corresponding SMTX OS version: SMTXOS-4.0.7-CSI-solution-el7) or higher</li>
<li>Helm v3.3.x</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="setup-kubernetes"></a><a href="#setup-kubernetes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup Kubernetes</h2>
<h3><a class="anchor" aria-hidden="true" id="enable-kubernetes-features"></a><a href="#enable-kubernetes-features" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enable Kubernetes features</h3>
<p>Enable the CSI related features to ensure that the driver works normally.</p>
<p>After a feature is GA, the feature gate will be removed in the next few versions. Please refer to <strong><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/">feature-gates</a></strong> to selectively enable features.</p>
<table>
<thead>
<tr><th>Feature Gate</th><th>Default</th><th>Stage</th><th>Since</th><th>Until</th></tr>
</thead>
<tbody>
<tr><td>CSINodeInfo</td><td>false</td><td>Alpha</td><td>1.12</td><td>1.13</td></tr>
<tr><td>CSINodeInfo</td><td>true</td><td>Beta</td><td>1.14</td><td>1.16</td></tr>
<tr><td>CSINodeInfo</td><td>true</td><td>GA</td><td>1.17</td><td>-</td></tr>
<tr><td>CSIDriverRegistry</td><td>false</td><td>Alpha</td><td>1.12</td><td>1.13</td></tr>
<tr><td>CSIDriverRegistry</td><td>true</td><td>Beta</td><td>1.14</td><td>1.16</td></tr>
<tr><td>CSIDriverRegistry</td><td>true</td><td>GA</td><td>1.17</td><td>-</td></tr>
<tr><td>VolumeSnapshotDataSource</td><td>false</td><td>Alpha</td><td>1.12</td><td>1.16</td></tr>
<tr><td>VolumeSnapshotDataSource</td><td>true</td><td>Beta</td><td>1.17</td><td>-</td></tr>
<tr><td>VolumePVCDataSource</td><td>false</td><td>Alpha</td><td>1.15</td><td>1.15</td></tr>
<tr><td>VolumePVCDataSource</td><td>true</td><td>Beta</td><td>1.16</td><td>1.17</td></tr>
<tr><td>VolumePVCDataSource</td><td>true</td><td>GA</td><td>1.18</td><td>-</td></tr>
<tr><td>ExpandCSIVolumes</td><td>false</td><td>Alpha</td><td>1.14</td><td>1.15</td></tr>
<tr><td>ExpandCSIVolumes</td><td>true</td><td>Beta</td><td>1.16</td><td>-</td></tr>
<tr><td>CSIBlockVolume</td><td>false</td><td>Alpha</td><td>1.11</td><td>1.13</td></tr>
<tr><td>CSIBlockVolume</td><td>true</td><td>Beta</td><td>1.14</td><td>1.17</td></tr>
<tr><td>CSIBlockVolume</td><td>true</td><td>GA</td><td>1.18</td><td>-</td></tr>
<tr><td>ExpandInUsePersistentVolumes</td><td>false</td><td>Beta</td><td>1.11</td><td>1.14</td></tr>
<tr><td>ExpandInUsePersistentVolumes</td><td>true</td><td>Beta</td><td>1.15</td><td>-</td></tr>
</tbody>
</table>
<p>For Kubernetes 1.17+, we can open all feature gates. Different Kubernetes clusters may have different ways of configuration. Here we assume the cluster is deployed by <code>kubeadm</code>.</p>
<ol>
<li>Enable feature gates on each <code>kube-apiserver</code>: <code>--feature-gates=CSINodeInfo=true,CSIDriverRegistry=true,CSIBlockVolume=true,VolumeSnapshotDataSource=true,VolumePVCDataSource=true,ExpandCSIVolumes=true,ExpandInUsePersistentVolumes=true</code> and <code>--allow-privileged=true</code></li>
</ol>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># /etc/kubernetes/manifests/kube-apiserver.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">kube-apiserver</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">containers:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">kube-apiserver</span>
    <span class="hljs-comment"># enable feature-gates here</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">--feature-gates=CSINodeInfo=true,CSIDriverRegistry=true,CSIBlockVolume=true,VolumeSnapshotDataSource=true,VolumePVCDataSource=true,ExpandCSIVolumes=true,ExpandInUsePersistentVolumes=true</span>
    <span class="hljs-comment"># enable privileged here</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">--allow-privileged=true</span>
</code></pre>
<ol start="2">
<li>Enable feature gates on each <code>kubelet</code>: <code>--feature-gates=CSINodeInfo=true,CSIDriverRegistry=true,CSIBlockVolume=true,VolumeSnapshotDataSource=true,VolumePVCDataSource=true,ExpandCSIVolumes=true,ExpandInUsePersistentVolumes=true</code>.</li>
</ol>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</span>
<span class="hljs-comment"># <span class="hljs-doctag">Note:</span> This dropin only works with kubeadm and kubelet v1.11+</span>
<span class="hljs-string">[Service]</span>
<span class="hljs-comment"># enable feature-gates here</span>
<span class="hljs-string">Environment="KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf</span> <span class="hljs-string">--kubeconfig=/etc/kubernetes/kubelet.conf</span> <span class="hljs-string">--feature-gates=CSINodeInfo=true,CSIDriverRegistry=true,CSIBlockVolume=true,VolumeSnapshotDataSource=true,VolumePVCDataSource=true,ExpandCSIVolumes=true,ExpandInUsePersistentVolumes=true"</span>
<span class="hljs-string">Environment="KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml"</span>
<span class="hljs-comment"># This is a file that "kubeadm init" and "kubeadm join" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically</span>
<span class="hljs-string">EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env</span>
<span class="hljs-comment"># This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use</span>
<span class="hljs-comment"># the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.</span>
<span class="hljs-string">EnvironmentFile=-/etc/sysconfig/kubelet</span>
<span class="hljs-string">ExecStart=</span>
<span class="hljs-string">ExecStart=/usr/bin/kubelet</span> <span class="hljs-string">$KUBELET_KUBECONFIG_ARGS</span> <span class="hljs-string">$KUBELET_CONFIG_ARGS</span> <span class="hljs-string">$KUBELET_KUBEADM_ARGS</span> <span class="hljs-string">$KUBELET_EXTRA_ARGS</span>
</code></pre>
<ol start="3">
<li>Reload Config</li>
</ol>
<pre><code class="hljs css language-shell">systemctl daemon-reload
systemctl restart kubelet
</code></pre>
<ol start="4">
<li>Wait until kubelet and kube-apiserver ready</li>
</ol>
<pre><code class="hljs css language-shell">systemctl status kubelet
</code></pre>
<pre><code class="hljs css language-output"><span class="hljs-string">●</span> <span class="hljs-attr">kubelet.service - kubelet:</span> <span class="hljs-string">The</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">Node</span> <span class="hljs-string">Agent</span>
   <span class="hljs-attr">Loaded:</span> <span class="hljs-string">loaded</span> <span class="hljs-string">(/usr/lib/systemd/system/kubelet.service;</span> <span class="hljs-string">enabled;</span> <span class="hljs-attr">vendor preset:</span> <span class="hljs-string">disabled)</span>
  <span class="hljs-attr">Drop-In:</span> <span class="hljs-string">/usr/lib/systemd/system/kubelet.service.d</span>
           <span class="hljs-string">└─10-kubeadm.conf</span>
   <span class="hljs-attr">Active:</span> <span class="hljs-string">active</span> <span class="hljs-string">(running)</span> <span class="hljs-string">since</span> <span class="hljs-string">Mon</span> <span class="hljs-number">2020</span><span class="hljs-number">-09</span><span class="hljs-number">-23</span> <span class="hljs-number">14</span><span class="hljs-string">:36:18</span> <span class="hljs-string">CST;</span>
</code></pre>
<pre><code class="hljs css language-shell">kubectl wait --for=condition=Ready  pod/kube-apiserver-&lt;suffix&gt; -n kube-system
</code></pre>
<pre><code class="hljs css language-output">pod/kube-apiserver-<span class="hljs-tag">&lt;<span class="hljs-name">suffix</span>&gt;</span> condition met
</code></pre>
<blockquote>
<p><strong><em>Note:</em> If you use openshift4.5 or highter, the Kubernetes version in openshift is KubernetesV1.18 or highter, all feature are opened default.</strong></p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="deploy-common-snapshot-controller"></a><a href="#deploy-common-snapshot-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploy Common Snapshot Controller</h3>
<p>The volume snapshot controller management is similar to pv/pvc controller, it manages the snapshot CRDs.
Regardless of the number CSI drivers deployed on the cluster, there must be only one instance of the volume snapshot controller running and one set of volume snapshot CRDs installed per cluster.</p>
<ol>
<li>Download <strong><a href="https://github.com/kubernetes-csi/external-snapshotter/tree/release-2.1">external-controller repo</a></strong></li>
</ol>
<pre><code class="hljs css language-shell">curl -LO https://github.com/kubernetes-csi/external-snapshotter/archive/release-2.1.zip
unzip release-2.1.zip &amp;&amp; cd external-snapshotter-release-2.1
</code></pre>
<ol start="2">
<li>Create Snapshot Beta CRD</li>
</ol>
<pre><code class="hljs css language-shell">kubectl create -f ./config/crd
</code></pre>
<ol start="3">
<li>Install Common Snapshot Controller</li>
</ol>
<pre><code class="hljs css language-shell">kubectl apply -f ./deploy/kubernetes/snapshot-controller
</code></pre>
<blockquote>
<p><strong><em>Note:</em> replace with the snapshot-controller's namespace, e.g. kube-system</strong></p>
</blockquote>
<ol start="4">
<li>Verify</li>
</ol>
<pre><code class="hljs css language-shell">kubectl get statefulset  snapshot-controller -n &lt;your-namespace&gt;
</code></pre>
<pre><code class="hljs css language-output">NAME                  READY   AGE
snapshot-controller   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     <span class="hljs-number">32</span>s
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="setup-zbs-cluster"></a><a href="#setup-zbs-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup ZBS Cluster</h2>
<ol>
<li><p>Ensure that the kubernetes cluster can connect with the ZBS cluster's access network</p></li>
<li><p>Configure <code>zbs-cluster-vip</code> in the access network segment</p></li>
</ol>
<pre><code class="hljs css language-shell">zbs-task vip set iscsi &lt;zbs-cluster-vip&gt;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="setup-open-iscsi"></a><a href="#setup-open-iscsi" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup open-iscsi</h2>
<ol>
<li>Install <code>iscsi-initiator-utils</code> on each kubernetes node</li>
</ol>
<pre><code class="hljs css language-shell">yum install iscsi-initiator-utils
</code></pre>
<ol start="2">
<li>Ensure that the node.startup option of <code>/etc/iscsi/iscsid.conf</code> is manual</li>
</ol>
<pre><code class="hljs css language-shell">sed -i 's/^node.startup = automatic$/node.startup = manual/' /etc/iscsi/iscsid.conf
</code></pre>
<ol start="3">
<li>Disable selinux</li>
</ol>
<pre><code class="hljs css language-shell">setenforce 0
sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config
</code></pre>
<ol start="4">
<li>Enable and start <code>iscsid</code></li>
</ol>
<pre><code class="hljs css language-shell">systemctl enable --now iscsid
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="setup-helm"></a><a href="#setup-helm" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup Helm</h2>
<p>Please refer to <strong><a href="https://helm.sh/docs/intro/install/">Install Helm</a></strong>.</p>
<blockquote>
<p><strong><em>Note</em>: If Helm is not allowed, please install it locally.</strong></p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="deploy-zbs-csi-driver"></a><a href="#deploy-zbs-csi-driver" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploy zbs-csi-driver</h2>
<ol>
<li>When multiple kubernetes clusters or other platforms (eg. openstack, esxi) share a ZBS cluster, each kubernetes cluster needs to be assigned a unique <code>kubernetes-cluster-id</code>. The <code>kubernetes-cluster-id</code> should not be changed once assigned.</li>
</ol>
<blockquote>
<p><strong><em>Note:</em> The <code>kubernetes-cluster-id</code> cloud be kubernetes cluster name or kubernetes cluster id. The <code>kubernetes-cluster-id</code> can be obtained from the kubernetes cluster management platform(eg. eks) or the cluster administrator can specify a string of length less than 255.</strong></p>
</blockquote>
<ol start="2">
<li>Create Namespace</li>
</ol>
<pre><code class="hljs css language-shell">kubectl create namespace iomesh-system
</code></pre>
<ol start="3">
<li>Add Helm repo</li>
</ol>
<pre><code class="hljs css language-shell">helm repo add iomesh http://iomesh.com/charts
</code></pre>
<ol start="4">
<li>Deploy Driver</li>
</ol>
<p>Get values.yaml from chart</p>
<pre><code class="hljs css language-shell">helm show values iomesh/zbs-csi-driver --version 0.1.2 &gt; values.yaml
</code></pre>
<p>Configure the blank items in the driver section in values.yaml</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-1-tab-2" class="nav-link active" data-group="group_1" data-tab="tab-group-1-content-2">kubernetes</div><div id="tab-group-1-tab-3" class="nav-link" data-group="group_1" data-tab="tab-group-1-content-3">openshift</div></div><div class="tab-content"><div id="tab-group-1-content-2" class="tab-pane active" data-group="group_1" tabindex="-1"><div><span><pre><code class="hljs css language-yaml"><span class="hljs-comment"># values.yaml</span><br /><span class="hljs-comment"># Default values for zbs-csi-driver.</span><br /><span class="hljs-comment"># This is a YAML-formatted file.</span><br /><span class="hljs-comment"># Declare variables to be passed into your templates.</span><br /><span class="hljs-comment"># If set resouce's name will be release-name-&lt;nameOverride&gt;</span><br /><span class="hljs-attr">nameOverride:</span> <span class="hljs-string">""</span><br /><span class="hljs-comment"># If set resouce's name will be &lt;fullnameOverride&gt;</span><br /><span class="hljs-attr">fullnameOverride:</span> <span class="hljs-string">""</span><br /><br /><span class="hljs-attr">rbac:</span><br />  <span class="hljs-comment"># Create ClusterRole</span><br />  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br /><br /><span class="hljs-attr">serviceAccount:</span><br />  <span class="hljs-comment"># Specifies whether a service account should be created</span><br />  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br /><br /><span class="hljs-comment"># Container Orchestration system (eg. "kubernetes"/"openshift" )</span><br /><span class="hljs-attr">co:</span> <span class="hljs-string">"kubernetes"</span><br /><span class="hljs-attr">coVersion:</span> <span class="hljs-string">""</span><br /><br /><span class="hljs-attr">driver:</span><br />  <span class="hljs-comment"># The unique csi driver name in a kubernetes cluster</span><br />  <span class="hljs-attr">name:</span><br />  <span class="hljs-comment"># kubernetes-cluster-id</span><br />  <span class="hljs-attr">clusterID:</span><br />  <span class="hljs-comment"># EXTERNAL / HCI</span><br />  <span class="hljs-attr">deploymentMode:</span><br />  <span class="hljs-comment"># meta proxy (eg. `zbs-cluster-vip:10206` )</span><br />  <span class="hljs-attr">metaProxy:</span><br />  <span class="hljs-comment"># iscsi portal (eg. EXTERNAL: `zbs-cluster-vip:3260`, HCI: `127.0.0.1:3260` )</span><br />  <span class="hljs-comment"># Note that the iscsi portal is a vip, please do not modify it once assigned.</span><br />  <span class="hljs-attr">iscsiPortal:</span><br />  <span class="hljs-comment"># CentOS7 / CentOS8 / CoreOS</span><br />  <span class="hljs-attr">linuxDistro:</span><br /><br />  <span class="hljs-attr">controller:</span><br />    <span class="hljs-comment"># controller replicas</span><br />    <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br />    <span class="hljs-comment"># use hostNetwork to access zbs cluster</span><br />    <span class="hljs-attr">hostNetwork:</span> <span class="hljs-literal">true</span><br />    <span class="hljs-attr">driver:</span><br />      <span class="hljs-comment"># driver ports(If hostNetwork is true, ports are host ports)</span><br />      <span class="hljs-attr">ports:</span><br />        <span class="hljs-comment"># csi health port</span><br />        <span class="hljs-attr">health:</span> <span class="hljs-number">9810</span><br /><br />  <span class="hljs-attr">node:</span><br />    <span class="hljs-attr">driver:</span><br />      <span class="hljs-comment"># host ports</span><br />      <span class="hljs-attr">ports:</span><br />        <span class="hljs-comment"># csi health port</span><br />        <span class="hljs-attr">health:</span> <span class="hljs-number">9811</span><br />        <span class="hljs-comment"># node plugin liveness port</span><br />        <span class="hljs-attr">liveness:</span> <span class="hljs-number">9812</span><br /><br />  <span class="hljs-attr">images:</span><br />    <span class="hljs-attr">driver:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">iomesh/zbs-csi-driver</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v2.0.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">registrar:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-node-driver-registrar</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v1.0.2</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">livenessprobe:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/livenessprobe</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v1.1.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">snapshotter:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-snapshotter</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v2.1.1</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">provisioner:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-provisioner</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v1.6.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">attacher:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-attacher</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v2.2.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">resizer:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-resizer</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v0.5.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br /></code></pre>
</span></div></div><div id="tab-group-1-content-3" class="tab-pane" data-group="group_1" tabindex="-1"><div><span><pre><code class="hljs css language-yaml"><span class="hljs-comment"># values.yaml</span><br /><span class="hljs-comment"># Default values for zbs-csi-driver.</span><br /><span class="hljs-comment"># This is a YAML-formatted file.</span><br /><span class="hljs-comment"># Declare variables to be passed into your templates.</span><br /><span class="hljs-comment"># If set resouce's name will be release-name-&lt;nameOverride&gt;</span><br /><span class="hljs-attr">nameOverride:</span> <span class="hljs-string">""</span><br /><span class="hljs-comment"># If set resouce's name will be &lt;fullnameOverride&gt;</span><br /><span class="hljs-attr">fullnameOverride:</span> <span class="hljs-string">""</span><br /><br /><span class="hljs-attr">rbac:</span><br />  <span class="hljs-comment"># Create ClusterRole</span><br />  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br /><br /><span class="hljs-attr">serviceAccount:</span><br />  <span class="hljs-comment"># Specifies whether a service account should be created</span><br />  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br /><br /><span class="hljs-comment"># Container Orchestration system (eg. "kubernetes"/"openshift" )</span><br /><span class="hljs-attr">co:</span> <span class="hljs-string">"openshift"</span><br /><span class="hljs-attr">coVersion:</span> <span class="hljs-string">""</span><br /><br /><span class="hljs-attr">driver:</span><br />  <span class="hljs-comment"># The unique csi driver name in a kubernetes cluster</span><br />  <span class="hljs-attr">name:</span><br />  <span class="hljs-comment"># kubernetes-cluster-id</span><br />  <span class="hljs-attr">clusterID:</span><br />  <span class="hljs-comment"># EXTERNAL / HCI</span><br />  <span class="hljs-attr">deploymentMode:</span><br />  <span class="hljs-comment"># meta proxy (eg. `zbs-cluster-vip:10206` )</span><br />  <span class="hljs-attr">metaProxy:</span><br />  <span class="hljs-comment"># iscsi portal (eg. EXTERNAL: `zbs-cluster-vip:3260`, HCI: `127.0.0.1:3260` )</span><br />  <span class="hljs-comment"># Note that the iscsi portal is a vip, please do not modify it once assigned.</span><br />  <span class="hljs-attr">iscsiPortal:</span><br />  <span class="hljs-comment"># CentOS7 / CentOS8 / CoreOS</span><br />  <span class="hljs-attr">linuxDistro:</span><br /><br />  <span class="hljs-attr">controller:</span><br />    <span class="hljs-comment"># controller replicas</span><br />    <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br />    <span class="hljs-comment"># use hostNetwork to access zbs cluster</span><br />    <span class="hljs-attr">hostNetwork:</span> <span class="hljs-literal">true</span><br />    <span class="hljs-attr">driver:</span><br />      <span class="hljs-comment"># driver ports(If hostNetwork is true, ports are host ports)</span><br />      <span class="hljs-attr">ports:</span><br />        <span class="hljs-comment"># csi health port</span><br />        <span class="hljs-attr">health:</span> <span class="hljs-number">9810</span><br /><br />  <span class="hljs-attr">node:</span><br />    <span class="hljs-attr">driver:</span><br />      <span class="hljs-comment"># host ports</span><br />      <span class="hljs-attr">ports:</span><br />        <span class="hljs-comment"># csi health port</span><br />        <span class="hljs-attr">health:</span> <span class="hljs-number">9811</span><br />        <span class="hljs-comment"># node plugin liveness port</span><br />        <span class="hljs-attr">liveness:</span> <span class="hljs-number">9812</span><br /><br />  <span class="hljs-attr">images:</span><br />    <span class="hljs-attr">driver:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">iomesh/zbs-csi-driver</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v2.0.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">registrar:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-node-driver-registrar</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v1.0.2</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">livenessprobe:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/livenessprobe</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v1.1.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">snapshotter:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-snapshotter</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v2.1.1</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">provisioner:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-provisioner</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v1.6.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">attacher:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-attacher</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v2.2.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br />    <span class="hljs-attr">resizer:</span><br />      <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io/k8scsi/csi-resizer</span><br />      <span class="hljs-attr">tag:</span> <span class="hljs-string">v0.5.0</span><br />      <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br /></code></pre>
<blockquote>
<p><strong><em>Note:</em> If you use openshift config, The installation process will automatically create a Security Context Constraints named scc-zbs-csi-driver, which is used to allow all zbs-csi related containers to become Privileged Containers to provide storage-related functions</strong></p>
</blockquote>
</span></div></div></div></div>
<blockquote>
<p><strong><em>Note:</em> If you need to use different zbs cluster storage in the same kubernetes cluster, please deploy multiple sets of zbs-csi-drivers with different driver names,  meta proxys and iscsi portals to ensure that the csi drivers are different. Additionally, it necessary to avoid conflicts between <code>driver.controller.ports</code> and <code>driver.node.ports</code> of different zbs-csi-drivers.</strong></p>
</blockquote>
<p>Install zbs-csi-driver</p>
<pre><code class="hljs css language-shell">helm install -f ./values.yaml --namespace iomesh-system &lt;release-name&gt; iomesh/zbs-csi-driver --version 0.1.2
</code></pre>
<p>If Helm is not allowed, please install it locally. Then use Helm to generate driver.yaml.</p>
<pre><code class="hljs css language-shell">helm template -f ./values.yaml --release-name &lt;release-name&gt; --namespace iomesh-system  iomesh/zbs-csi-driver --version 0.1.2 &gt; driver.yaml
</code></pre>
<p>Copy driver.yaml to the target server and apply it.</p>
<pre><code class="hljs css language-shell">kubectl apply -f driver.yaml
</code></pre>
<ol start="5">
<li>Wait for ready</li>
</ol>
<pre><code class="hljs css language-shell">kubectl get pod -n iomesh-system
</code></pre>
<pre><code class="hljs css language-output">NAME                                                READY   STATUS    RESTARTS   AGE
zbs-csi-driver-controller-plugin<span class="hljs-number">-5</span>dbfb48d5c<span class="hljs-number">-2</span>sk97   <span class="hljs-number">6</span>/<span class="hljs-number">6</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">42</span>s
zbs-csi-driver-controller-plugin<span class="hljs-number">-5</span>dbfb48d5c-cfhwt   <span class="hljs-number">6</span>/<span class="hljs-number">6</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">42</span>s
zbs-csi-driver-controller-plugin<span class="hljs-number">-5</span>dbfb48d5c-drl7s   <span class="hljs-number">6</span>/<span class="hljs-number">6</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">42</span>s
zbs-csi-driver-node-plugin<span class="hljs-number">-25585</span>                    <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">39</span>s
zbs-csi-driver-node-plugin-fscsp                    <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">30</span>s
zbs-csi-driver-node-plugin-g4c4v                    <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">39</span>s
</code></pre>
<ol start="6">
<li>Setup StorageClass</li>
</ol>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># storageclass.yaml</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">StorageClass</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">storage.k8s.io/v1</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">zbs-csi-driver-default</span>
<span class="hljs-comment"># driver.name in values.yaml</span>
<span class="hljs-attr">provisioner:</span> <span class="hljs-string">&lt;driver.name&gt;</span>
<span class="hljs-comment"># Delete / Retain</span>
<span class="hljs-attr">reclaimPolicy:</span> <span class="hljs-string">Retain</span>
<span class="hljs-attr">allowVolumeExpansion:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">parameters:</span>
  <span class="hljs-comment"># "ext4" / "ext3" / "ext2" / "xfs"</span>
  <span class="hljs-attr">csi.storage.k8s.io/fstype:</span> <span class="hljs-string">"ext4"</span>
  <span class="hljs-comment"># "1" / "2" / "3"</span>
  <span class="hljs-attr">replicaFactor:</span> <span class="hljs-string">"1"</span>
  <span class="hljs-comment"># "true" / "false"</span>
  <span class="hljs-attr">thinProvision:</span> <span class="hljs-string">"true"</span>
</code></pre>
<pre><code class="hljs css language-shell">kubectl apply -f storageclass.yaml
</code></pre>
<ol start="7">
<li>Setup SnapshotClass</li>
</ol>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># snapshotclass.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">snapshot.storage.k8s.io/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">VolumeSnapshotClass</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">zbs-csi-driver-default</span>
<span class="hljs-comment"># driver.name in values.yaml</span>
<span class="hljs-attr">driver:</span> <span class="hljs-string">&lt;dirver.name&gt;</span>
<span class="hljs-comment"># Delete / Retain</span>
<span class="hljs-attr">deletionPolicy:</span> <span class="hljs-string">Retain</span>
</code></pre>
<pre><code class="hljs css language-shell">kubectl apply -f snapshotclass.yaml
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h2>
<h3><a class="anchor" aria-hidden="true" id="fio"></a><a href="#fio" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fio</h3>
<ol>
<li>Install Fio testing pod</li>
</ol>
<pre><code class="hljs css language-shell">kubectl apply -f http://www.iomesh.com/iomesh-docs/docs/assets/zbs-csi-driver/example/fio.yaml
</code></pre>
<ol start="2">
<li>Wait until fio-pvc bound and fio pod ready</li>
</ol>
<pre><code class="hljs css language-shell">kubectl get pvc fio-pvc
</code></pre>
<pre><code class="hljs css language-output">NAME      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS             AGE
fio-pvc   Bound    pvc-d7916b34<span class="hljs-number">-50</span>cd<span class="hljs-number">-49</span>bd<span class="hljs-number">-86</span>f9<span class="hljs-number">-5287</span>db1265cb   <span class="hljs-number">30</span>Gi       RWO            zbs-csi-driver-<span class="hljs-section">default</span>   <span class="hljs-number">15</span>s
</code></pre>
<pre><code class="hljs css language-shell">kubectl wait --for=condition=Ready pod/fio
</code></pre>
<pre><code class="hljs css language-output">pod/fio <span class="hljs-keyword">condition</span> met
</code></pre>
<ol start="3">
<li>Run test</li>
</ol>
<pre><code class="hljs css language-shell">kubectl exec -it fio sh
fio --name fio --filename=/mnt/fio --bs=256k --rw=write --ioengine=libaio --direct=1 --iodepth=128 --numjobs=1 --size=$(blockdev --getsize64 /mnt/fio)
fio --name fio --filename=/mnt/fio --bs=4k --rw=randread --ioengine=libaio --direct=1 --iodepth=128 --numjobs=1 --size=$(blockdev --getsize64 /mnt/fio)
</code></pre>
<ol start="4">
<li>Cleanup</li>
</ol>
<pre><code class="hljs css language-shell">kubectl delete pod fio
kubectl delete pvc fio-pvc
<span class="hljs-meta">#</span><span class="bash"> You need to delete pv when reclaimPolicy is Retain</span>
kubectl delete pvc-d7916b34-50cd-49bd-86f9-5287db1265cb
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zbs-csi-driver/overview"><span class="arrow-prev">← </span><span>Overview</span></a><a class="docs-next button" href="/docs/zbs-operator/overview"><span>Overview</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#supported-platforms">Supported platforms</a></li><li><a href="#setup-kubernetes">Setup Kubernetes</a><ul class="toc-headings"><li><a href="#enable-kubernetes-features">Enable Kubernetes features</a></li><li><a href="#deploy-common-snapshot-controller">Deploy Common Snapshot Controller</a></li></ul></li><li><a href="#setup-zbs-cluster">Setup ZBS Cluster</a></li><li><a href="#setup-open-iscsi">Setup open-iscsi</a></li><li><a href="#setup-helm">Setup Helm</a></li><li><a href="#deploy-zbs-csi-driver">Deploy zbs-csi-driver</a></li><li><a href="#example">Example</a><ul class="toc-headings"><li><a href="#fio">Fio</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"></footer></div></body></html>